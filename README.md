# クレジットカード利用通知システム

クレジットカードの利用明細をGmailから自動取得し、Googleスプレッドシートで管理し、Slackに通知を送信するGoogle Apps Scriptアプリケーションです。

## 概要

このシステムは以下の機能を提供します：

- **Gmail監視**: クレジットカード会社からの利用通知メールを自動的に監視
- **データ抽出**: メールから利用日、利用店舗、利用金額などの情報を抽出
- **スプレッドシート管理**: 利用明細をGoogleスプレッドシートに自動記録
- **Slack通知**: 利用情報をSlackチャンネルにリアルタイム通知
- **カレンダー連携**: 利用情報をGoogleカレンダーに追加

## システム構成

```
src/
├── card_controller.js      # メイン処理とカード会社別の処理制御
├── gmail_controller.js     # Gmail連携機能
├── slack_controller.js     # Slack通知機能
├── sheet_controller.js     # Googleスプレッドシート操作
└── calendar_controller.js  # Googleカレンダー連携
```

## 必要な設定

### 1. Google Apps Scriptプロパティ

以下のスクリプトプロパティを設定してください：

- `SLACK_BOT_TOKEN`: SlackボットのOAuthトークン
- `CALENDAR_ID`: 通知を追加するGoogleカレンダーのID

### 2. Googleスプレッドシート

以下のシートを含むスプレッドシートを作成してください：

- **カード情報**: カード名、絵文字、合計金額などの管理
- **利用明細**: 利用履歴の記録
- **更新情報**: カード会社ごとの監視設定と最終更新日

### 3. Slack設定

- Slackワークスペースにボットアプリを作成
- `#money`チャンネル（または任意のチャンネル）への投稿権限を付与
- ボットトークンをスクリプトプロパティに設定

## 対応カード会社

現在、以下のカード会社の利用通知メールに対応しています：

- リクルートカード
- JCB CARD W
- その他（追加設定により拡張可能）

## 使用方法

1. Google Apps Scriptでプロジェクトを作成
2. 必要なAPIを有効化（Gmail API、Calendar API、Sheets API）
3. スクリプトプロパティを設定
4. Googleスプレッドシートを準備
5. `CardController.main()`を定期実行するトリガーを設定

## 機能詳細

### メール監視
- 設定されたメール件名を監視
- カード会社ごとに異なるメール形式に対応
- 重複処理を防ぐため、最終処理日を記録

### Slack通知
利用通知には以下の情報が含まれます：
- カード名
- 利用日
- 利用店舗
- 利用金額
- カード別合計金額
- 月間総利用金額

### データ管理
- 利用明細を自動的にスプレッドシートに記録
- カード別の利用状況を集計
- 月間利用総額を自動計算

## カスタマイズ

新しいカード会社に対応する場合は、`CardController.CARD_RECEIVES`に処理関数を追加してください。各カード会社のメール形式に応じて、利用情報を抽出するロジックを実装します。

## 注意事項

- Gmail APIの制限により、大量のメール処理には時間がかかる場合があります
- スクリプトの実行時間制限（6分）にご注意ください
- 個人情報を含むため、適切なアクセス権限設定を行ってください

## ライセンス

このプロジェクトは個人利用を想定しています。商用利用の場合は、適切なライセンス条項を確認してください。
